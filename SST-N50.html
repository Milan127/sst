<script>
  const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQJoID6vuDnZN4q_-6Jj4MiG2yvF3u573bwPXbrfK2zW1WnIDfVVobFYOVDQydWH85eEHflBq2SMtlE/pub?gid=981225084&single=true&output=csv';

  fetch(sheetUrl)
    .then(res => res.text())
    .then(csv => {
      const rows = csv.trim().split('\n');
      const table = document.getElementById('csvTable');

      rows.forEach((row, i) => {
        const cols = row.split(',');
        const tr = document.createElement('tr');

        cols.forEach((col, j) => {
          const cell = document.createElement(i < 3 ? 'th' : 'td');
          const content = col.trim();

          if (i >= 3) {
            const tickerCol = 0;
            const todayChangeCol = 6;
            const percentDiffCol = 7;
            const gttUpdateCol = 8;
            const pnlCol = 12;

            // ðŸ”— Ticker to TradingView
            if (j === tickerCol && content !== '') {
              const link = document.createElement('a');
              link.href = `https://www.tradingview.com/chart/?symbol=NSE:${content}`;
              link.target = "_blank";
              link.textContent = content;
              cell.appendChild(link);
              tr.appendChild(cell);
              return;
            }

            // ðŸ“ˆ Color for TODAY CHANGE
            if (j === todayChangeCol || j === percentDiffCol || j === pnlCol) {
              const num = parseFloat(content);
              if (!isNaN(num)) {
                cell.style.fontWeight = "bold";
                cell.style.color = num > 0 ? "green" : (num < 0 ? "red" : "black");
              }
            }

            // ðŸŽ¨ GTT UPDATE color background
            if (j === gttUpdateCol) {
              const val = content.toUpperCase();
              if (val === "TRIGGERED") {
                cell.style.backgroundColor = "#28a745";
                cell.style.color = "white";
                cell.style.fontWeight = "bold";
              } else if (val === "YES") {
                cell.style.backgroundColor = "#ffc107";
                cell.style.color = "black";
                cell.style.fontWeight = "bold";
              } else if (val === "NEW ADD") {
                cell.style.backgroundColor = "#007bff";
                cell.style.color = "white";
                cell.style.fontWeight = "bold";
              }
            }
          }

          if (cell.childNodes.length === 0) {
            cell.textContent = content;
          }

          tr.appendChild(cell);
        });

        table.appendChild(tr);
      });
    });
</script>
